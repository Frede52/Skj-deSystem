@page "/viewapartmenttask/{apartmentId}/{address}"
@inject NavigationManager NavigationManager
@inject HttpClient Http

<head>
    <link href="css/viewapartmenttask.css" rel="stylesheet" />
</head>

<h1>Opgaveliste for Lejlighed @address</h1>

<div style="margin-bottom: 10px; text-align: right;">
    <button class="btn btn-primary" @onclick="NavigateToCreateTask">
        Opret opgave
    </button>
</div>

<table class="table table-bordered" border="3" style="table-layout: fixed; width: 100%;">
    <thead>
        <tr>
            <th style="width: 40%;">Opgaver</th>
            <th style="width: 20%;">Underentreprenør</th>
            <th style="width: 10%;">Dato</th>
            <th style="width: 10%;">Status</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var task in tasks)
        {
            <tr>
                <td style="word-wrap: break-word;">@task.Description</td>
                <td>@task.AssignedTo.SubcontractorName</td>
                <td>@task.StartDate.ToString("yyyy-MM-dd")</td>
                <td>
                    <select class="form-control" @bind="task.Status">
                        <option value="Pending">Ikke påbegyndt</option>
                        <option value="InProgress">Påbegyndt</option>
                        <option value="Completed">Færdig</option>
                    </select>
                </td>
            </tr>
        }
    </tbody>
</table>

<h3>Kontaktoplysninger</h3>

<table class="content-table">
    <thead>
        <tr>
            <th>Adresse</th>
            <th>ID</th>
            <th>Fornavn</th>
            <th>Efternavn</th>
            <th>Email</th>
            <th>Telefon</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>@address</td>
            <td>@apartmentId</td>
            <td>@firstName</td>
            <td>@lastName</td>
            <td>@email</td>
            <td>@phone</td>
        </tr>
    </tbody>
</table>

@code {
    [Parameter]
    public string apartmentId { get; set; }

    [Parameter]
    public string address { get; set; }

    private List<TaskItem> tasks = new List<TaskItem>();

    // Midlertidige data for kontaktinformationer
    private string firstName = "Magnus";
    private string lastName = "Kristensen";
    private string email = "Magnus@gmail.com";
    private string phone = "1234567890";

    protected override async Task OnInitializedAsync()
    {
        address = Uri.UnescapeDataString(address);

        // Hent opgaverne via API'et for den specifikke lejlighed
        tasks = await Http.GetFromJsonAsync<List<TaskItem>>($"https://localhost:7210/api/Task/GetTaskByApartmentId/{apartmentId}");
    }

    private void NavigateToCreateTask()
    {
        NavigationManager.NavigateTo($"/createtask/{apartmentId}");
    }
}
