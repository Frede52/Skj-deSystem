@page "/createtask/{ApartmentId:int}"
@inject NavigationManager NavigationManager
<PageTitle>CreateTask</PageTitle>

<EditForm Model="@task" OnValidSubmit="@SubmitTask">
    <DataAnnotationsValidator />
    <ValidationSummary />

<div class="shadow overflow-hidden sm:rounded-md bg-white dark:bg-black">


 <div class="grid grid-cols-6 gap-6">
  <div class="relative px-4 py-5 sm:p-6">
   <h3>Ny Opgave:</h3>

    <div class="col-span-6 sm:col-span-3">
        <label for="taskName">Opgave Navn:</label>
        <InputText id="taskName" class="form-control" @bind-Value="task.TaskName" placeholder="Navn på opgaven" />
    </div>

    <div class="col-span-6 sm:col-span-3">
        <label for="description">Beskrivelse:</label>
        <textarea id="description" class="form-control" @bind="task.Description" placeholder="Tilføj en beskrivelse til opgaven"> </textarea>
    </div>

    <div class="col-span-6 sm:col-span-3">
        <label for="ToDo">Tilføj Mangelliste:</label>
        <InputFile id="ToDo" class="form-control" @bind-Value="task.ToDoPDF" />
    </div>

    <div class="col-span-6 sm:col-span-3">
        <label for="startDate">Start Dato:</label>
        <InputDate id="startDate" class="form-control" @bind-Value="task.StartDate" TValue="DateOnly" />
    </div>

     <div class="col-span-6 sm:col-span-3">
        <label for="status">Status:</label>
        <InputSelect id="status" class="form-control" @bind-Value="task.Status">
            @foreach (var status in Statuses)
            {
                <option value="@status">@status</option>
            }
        </InputSelect>

    <div class="col-span-6 sm:col-span-3">
         <label for="status">Udføres af:</label>
            <InputSelect id="" class="form-control" @bind-Value="task.SubcontractorID">
               @foreach (var subconctractor in Subcontractors)
               {
                  <option value="@subconctractor">@subconctractor</option>
               }
           </InputSelect>
    </div>


    <div class="col-span-6 sm:col-span-3">
         <label for="address">Adresse:</label>
         <InputText id="address" class="form-control" @bind-Value="apartment.Address" readonly />
    </div>

     <div class="col-span-6 sm:col-span-3">
          <label for="comment">Kommentar:</label>
          <InputText id="comment" class="form-control" @bind-Value="task.Comment" placeholder="Kommentar fra UE" readonly />
     </div>

     <div class="col-span-6 sm:col-span-3">
         <label for="adminid">Oprettet af:</label>
         <InputNumber id="adminid" class="form-control" @bind-Value="task.AdminId" placeholder="xxx" readonly />
    </div>

     <div class="mt-4 px-4 py-3 bg-gray-50 dark:bg-gray-900 text-right sm:px-6">
        <div class="flex justify-between items-center">
        <button type="submit" class="btn btn-primary">Gem Opgave</button>
        </div>
     </div>
  </div>
 </div>
</div>
</div>

</EditForm>

@code {
    private string Status = "Not submitted";
    private List<string> Statuses = new() { "Afventer", "Iganværende", "Færdiggjort", };
    private TaskItem task = new TaskItem();
    private List<TaskItem> taskItems = new List<TaskItem>();
    private List<string> Subcontractors = new() { "Maler", "Murer", "Tømrer", "VVS" };

    //In memory liste af apartments:
    private Apartment apartment;
    public List<Apartment> apartments = new List<Apartment>
    {
        new Apartment { ApartmentId = 1, Address = "Sønderhøj 30"},
        new Apartment { ApartmentId = 2, Address = "Bryggerivej 23"},
        new Apartment { ApartmentId = 3, Address = "Fasanvej 99"}
    };

    // Find the apartment by ID in the in-memory list
    protected override void OnInitialized()
    {
       
        apartment = apartments.FirstOrDefault(a => a.ApartmentId == ApartmentId);
    }


    //SubtmitTask udføres når der trykkes på submit
    void SubmitTask()
    {
        Status = "Form submitted";
        taskItems.Add(task);
        task = new TaskItem();
        foreach (var task in taskItems)
        {
            Console.WriteLine($"Task Name: {task.TaskName}, Description: {task.Description}");
        }

        NavigationManager.NavigateTo($"/apartments");

    }

    [Parameter]
    public int ApartmentId { get; set; }
}
